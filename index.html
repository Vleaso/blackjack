<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#121117" />
  <link rel="manifest" href="manifest.json" />
  <title>Blackjack PWA</title>
  <style>
    :root {
      --bg-color: rgb(18, 17, 23);
      --card-color: rgb(109, 252, 135);
      --card-width: 20vw;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: var(--bg-color);
    }

    #hands-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: calc(var(--card-width) / 2);
      padding-top: 5vh;
    }

    .hand {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .card-label {
      color: white;
      margin-bottom: 0.5rem;
      font-size: 1.25rem;
    }

    .cards {
      display: flex;
      gap: 0.5rem;
    }

    .card {
      width: var(--card-width);
      height: calc(var(--card-width) * 7 / 5);
      background-color: var(--card-color);
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      opacity: 0;
      transform: translateX(100%);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }
    @keyframes slideIn {
      from { transform: translateX(100%); }
      to   { transform: translateX(0); }
    }
    .animate-card {
      animation: fadeIn 1s ease-in forwards, slideIn 2s ease-out forwards;
    }

    #controls {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }
    #controls button {
      padding: 0.75rem 1.5rem;
      font-size: 16px;
      touch-action: manipulation;
      cursor: pointer;
    }

    #money-counter {
      position: fixed;
      bottom: 0;
      width: 100%;
      text-align: center;
      font-size: 2rem;
      padding: 1rem 0;
      background: rgba(0,0,0,0.2);
      color: white;
      position: relative;
    }

    @keyframes popUpMoney {
      from { opacity: 1; transform: translateX(-50%) translateY(0); }
      to   { opacity: 0; transform: translateX(-50%) translateY(-100px); }
    }
    .money-popup {
      position: absolute;
      left: 50%;
      bottom: 100%;
      transform: translateX(-50%) translateY(0);
      font-size: 1.5rem;
      pointer-events: none;
      animation: popUpMoney 2s linear forwards;
    }
  </style>
</head>
<body>
  <div id="hands-container">
    <div class="hand">
      <div class="card-label">House (<span id="house-score">0</span>)</div>
      <div class="cards" id="house-cards"></div>
    </div>
    <div class="hand">
      <div class="card-label">Player (<span id="player-score">0</span>)</div>
      <div class="cards" id="player-cards"></div>
    </div>
  </div>

  <div id="controls">
    <button id="hit-button">Hit</button>
    <button id="stand-button">Stand</button>
  </div>

  <div id="money-counter">0</div>

  <script>
    // disable double-tap zoom
    let lastTouch = 0;
    document.addEventListener('touchend', function(e) {
      const now = Date.now();
      if (now - lastTouch <= 300) e.preventDefault();
      lastTouch = now;
    }, false);

    let playerCards = [];
    let houseCards = [];
    let money = 0;
    let gameOver = false;

    const pcDiv = document.getElementById('player-cards');
    const hcDiv = document.getElementById('house-cards');
    const psSpan = document.getElementById('player-score');
    const hsSpan = document.getElementById('house-score');
    const counter = document.getElementById('money-counter');
    const hitBtn = document.getElementById('hit-button');
    const standBtn = document.getElementById('stand-button');

    function drawCard() {
      return Math.floor(Math.random() * 10) + 1;
    }

    function calcScore(cards) {
      let total = 0, aces = 0;
      cards.forEach(c => {
        if (c === 1) aces++;
        else total += c;
      });
      total += aces * 11;
      while (total > 21 && aces > 0) {
        total -= 10;
        aces--;
      }
      return total;
    }

    function showMoneyPopup(amount) {
      const popup = document.createElement('span');
      popup.className = 'money-popup';
      popup.textContent = (amount > 0 ? '+' + amount : amount);
      popup.style.color = amount > 0 ? 'limegreen' : 'red';
      counter.appendChild(popup);
      setTimeout(() => popup.remove(), 2000);
    }

    function updateMoney() {
      counter.textContent = money;
      counter.style.color = money < 0 ? 'red' : 'white';
    }

    function render() {
      pcDiv.innerHTML = '';
      playerCards.forEach(c => {
        const d = document.createElement('div');
        d.className = 'card animate-card';
        d.textContent = c;
        pcDiv.appendChild(d);
      });
      hcDiv.innerHTML = '';
      houseCards.forEach(c => {
        const d = document.createElement('div');
        d.className = 'card animate-card';
        d.textContent = c;
        hcDiv.appendChild(d);
      });
      psSpan.textContent = calcScore(playerCards);
      hsSpan.textContent = calcScore(houseCards);
    }

    function startRound() {
      gameOver = false;
      playerCards = [drawCard()];
      houseCards  = [drawCard()];
      render();
    }

    function playerHit() {
      if (gameOver) { startRound(); return; }
      playerCards.push(drawCard());
      if (calcScore(playerCards) > 21) { endRound(); }
      else { houseHitOnce(); }
      render();
    }

    function houseHitOnce() {
      if (calcScore(houseCards) < 17) { houseCards.push(drawCard()); }
    }

    function housePlay() {
      while (calcScore(houseCards) < 17) { houseCards.push(drawCard()); }
    }

    function endRound() {
      gameOver = true;
      const p = calcScore(playerCards);
      const h = calcScore(houseCards);
      let delta = 0;
      if (p > 21 || (h <= 21 && h > p)) delta = -100;
      else if (h > 21 || p > h) delta = 100;
      if (delta !== 0) { money += delta; showMoneyPopup(delta); }
      updateMoney(); render();
    }

    hitBtn.addEventListener('click', () => {
      if (playerCards.length === 0) startRound();
      playerHit();
    });
    standBtn.addEventListener('click', () => {
      if (playerCards.length === 0) return;
      housePlay(); endRound();
    });

    updateMoney();
  </script>
</body>
</html>